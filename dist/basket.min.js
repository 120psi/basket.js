/*!
* basket.js
* v0.3.0 - 2012-11-28
* http://addyosmani.github.com/basket.js
* (c) Addy Osmani; MIT License
* Created by: Addy Osmani, Sindre Sorhus, AndrÃ©e Hansson
* Contributors: Ironsjp, Mathias Bynens, Rick Waldron, Felipe Morais
*/
(function(e,t){"use strict";var n=t.head||t.getElementsByTagName("head")[0],r="basket-",i=[],s=0,o=0,u=[],a=5e3,f=function(e){return{}.toString.call(e)==="[object Function]"},l=function(e,t){try{return localStorage.setItem(r+e,JSON.stringify(t)),!0}catch(n){if(n.name.toUpperCase().indexOf("QUOTA")>=0){var i,s=[];for(i in localStorage)i.indexOf(r)===0&&s.push(JSON.parse(localStorage[i]));if(s.length)return s.sort(function(e,t){return e.stamp-t.stamp}),basket.remove(s[0].key),l(e,t);return}return}},c=function(e,t){var n=new XMLHttpRequest;n.open("GET",e),n.onreadystatechange=function(){n.readyState===4&&n.status===200&&t(n.responseText)},n.send()},h=function(e,t){c(e.url,function(n){var r=v(e,n);l(e.key,r),f(t)&&t(n)})},p=function(e){var r=t.createElement("script");r.defer=!0,r.text=e,n.appendChild(r)},d=function(e,t){var n,r,o,a;if(s>=e)for(n=0;n<i.length;n++){o=i[n];if(!o)continue;i[n]=null,t&&p(o),s++;for(r=n;r<s;r++)a=u[r],f(a)&&(u[r]=null,a())}},v=function(e,t){var n=+(new Date);return e.data=t,e.stamp=n,e.expire=n+(e.expire||a)*60*60*1e3,e},m=function(e){var t=o,n=i.length,r,s=function(r){i[n]=r,d(t,e.execute)};if(!e.url)return;e.key=e.key||e.url,r=basket.get(e.key),e.execute=e.execute!==!1,i[n]=null,!r||r.expire- +(new Date)<0||e.unique!==r.unique?(e.unique&&(e.url+=(e.url.indexOf("?")>0?"&":"?")+"basket-unique="+e.unique),h(e,s)):s(r.data),f(e.wait)&&basket.wait(e.wait)};e.basket={require:function(){var e,t;for(e=0,t=arguments.length;e<t;e++)m(arguments[e]);return this},remove:function(e){return localStorage.removeItem(r+e),this},wait:function(e){return o=i.length-1,f(e)&&(s>o?e():u[o]=e),this},get:function(e){return JSON.parse(localStorage.getItem(r+e))||!1},clear:function(e){var t,n,i=+(new Date);for(t in localStorage)n=t.split(r)[1],n&&(!e||this.get(n).expire<=i)&&this.remove(n);return this}},basket.clear(!0)})(this,document);
/*!
* basket.js
* v0.3.0 - 2012-12-15
* http://addyosmani.github.com/basket.js
* (c) Addy Osmani; MIT License
* Created by: Addy Osmani, Sindre Sorhus, Andr√©e Hansson
* Contributors: Ironsjp, Mathias Bynens, Rick Waldron, Felipe Morais
*/
(function(a,b){"use strict",RSVP.all=function(a){var b,c=[],d=new RSVP.Promise,e=a.length,f=function(a){return function(b){g(a,b)}},g=function(a,b){c[a]=b,--e===0&&d.resolve(c)},h=function(a){d.reject(a)};for(b=0;b<e;b++)a[b].then(f(b),h);return d};var c=b.head||b.getElementsByTagName("head")[0],d="basket-",e=[],f=5e3,g=function(a,b){try{return localStorage.setItem(d+a,JSON.stringify(b)),!0}catch(c){if(c.name.toUpperCase().indexOf("QUOTA")>=0){var e,f=[];for(e in localStorage)e.indexOf(d)===0&&f.push(JSON.parse(localStorage[e]));if(f.length)return f.sort(function(a,b){return a.stamp-b.stamp}),basket.remove(f[0].key),g(a,b);return}return}},h=function(a){var b=new XMLHttpRequest,c=new RSVP.Promise;return b.open("GET",a),b.onreadystatechange=function(){b.readyState===4&&(b.status===200?c.resolve(b.responseText):c.reject(new Error(b.statusText)))},b.send(),c},i=function(a){return h(a.url).then(function(b){var c=k(a,b);return g(a.key,c),b})},j=function(a){var d=b.createElement("script");d.defer=!0,d.text=a,c.appendChild(d)},k=function(a,b){var c=+(new Date);return a.data=b,a.stamp=c,a.expire=c+(a.expire||f)*60*60*1e3,a},l=function(a){var b,c;if(!a.url)return;return a.key=a.key||a.url,b=basket.get(a.key),a.execute=a.execute!==!1,!b||b.expire- +(new Date)<0||a.unique!==b.unique?(a.unique&&(a.url+=(a.url.indexOf("?")>0?"&":"?")+"basket-unique="+a.unique),c=i(a)):(c=new RSVP.Promise,c.resolve(b.data)),a.execute?c.then(j):c};a.basket={require:function(){var a,b;for(a=0,b=arguments.length;a<b;a++)e.push(l(arguments[a]));return RSVP.all(e)},remove:function(a){return localStorage.removeItem(d+a),this},get:function(a){return JSON.parse(localStorage.getItem(d+a)||"false")},clear:function(a){var b,c,e=+(new Date);for(b in localStorage)c=b.split(d)[1],c&&(!a||this.get(c).expire<=e)&&this.remove(c);return this}},basket.clear(!0)})(this,document);